<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">

<link rel="import" href="/src/typio-app/typio-static-drill-creator.html">
<link rel="import" href="/src/typio-app/typio-basic-drill-creator.html">
<link rel="import" href="/src/typio-app/typio-program-drill-creator.html">
<link rel="import" href="/src/typio-app/typio-regex-drill-creator.html">

<link rel="import" href="/src/typio-app/shared-styles.html">

<dom-module id="typio-drill-creator">
  <template>
    <style include="shared-styles">

      :host {
        background-color: #666;        
        padding: 50px;
        overflow-y: scroll;
      }
      
      #editor {
        flex-direction: row;
      }
      
      #menu {
        width: 200px;
        float: left;
      }
      #configuration {
        margin-left: 250px;
      }
      
      #menu {
        margin: 0;
        padding: 0;
      }
      #menu li {
        list-style-type: none;
        margin-top: 10px;
        margin-bottom: 10px;
      }    
      #menu a {
        position: absolute;
        display: inline-block;
        width: 100%;
        padding: 10px 20px;
        background-color: rgba(0, 0, 0, .7);
        color: white;
        text-decoration: none;
      }  
      #menu a .name {
        display: block;
        font-size: 110%;
        font-weight: bold;
        color: var(--typio-bg-color);
      }
      #menu a .description {
        color: white;
        font-size: 90%;
      }
      
      #menu li {
        position: relative;
        width: 200px;
        height: 70px;
      }
      #menu li.selected a, #menu li:hover a {
          margin-top: -3px;
          margin-left: -3px;
          box-shadow: 3px 3px rgba(0, 0, 0, 0.5);
          transition: all 0.2s linear;
          background-color: var(--typio-bg-color);
      }
      #menu li.selected a .name, #menu li:hover a .name {
        color: black;
      }

    </style>

    <app-route
        route="{{route}}"
        pattern="/:view"
        data="{{routeData}}"
        tail="{{subroute}}">
    </app-route>
    
    <div id="editor">
      <ul id="menu">
        <li id="menu-static" class$="{{isSelected(routeData.view, 'static')}}">
          <a tabindex="-1" href="/drillCreator/static">
            <span class="name">Static</span>
            <span class="description">For obvious content</span>
          </a>
        </li>
        <li id="menu-basic" class$="{{isSelected(routeData.view, 'basic')}}">
          <a tabindex="-1" href="/drillCreator/basic">
            <span class="name">Basic</span>
            <span class="description">For a little randomization</span>
          </a>
        </li>
        <li id="menu-program" class$="{{isSelected(routeData.view, 'program')}}">
          <a tabindex="-1" href="/drillCreator/program">
            <span class="name">Program</span>
            <span class="description">For aspiring hackers</span>
          </a>
        </li>
        <li id="menu-regex" class$="{{isSelected(routeData.view, 'regex')}}">
          <a tabindex="-1" href="/drillCreator/regex">
            <span class="name">Regex</span>
            <span class="description">For the craziest ones</span>
          </a>
        </li>
      </ul>
      <div id="configuration">
        <iron-pages selected="[[routeData.view]]" attr-for-selected="name" fallback-selection="basic">      
          <typio-static-drill-creator name="static"></typio-static-drill-creator>
          <typio-basic-drill-creator name="basic"></typio-basic-drill-creator>
          <typio-program-drill-creator name="program"></typio-program-drill-creator>
          <typio-regex-drill-creator name="regex"></typio-regex-drill-creator>
        </iron-pages>
      </div>
    </div>

  </template>

  <script>
  

    /**
     * @customElement
     * @polymer
     */
    class TypioDrillCreator extends Polymer.Element {

      static get is() { return 'typio-drill-creator'; }
      static get properties() {
        return {
          
          //
          // Routing management
          //

          route: {
            type: Object
          },

          routeData: {
            type: Object
          },
          
        };
      }
      
      isSelected(route, menuEntry) {
        return (route === menuEntry) ? "selected" : "";
      }

      //
      // Utils
      //
      
      
      static generateDrill(drill) {
        switch (drill.type) {
          case 'static':
            return TypioDrillCreator.generateStaticDrill(drill.text);
          case 'basic':
            return TypioDrillCreator.generateBasicDrill(drill.keys, drill.weights);
        }
      }

      /**
       * Generates a content following the static drill definition.
       */
      static generateStaticDrill(text) {
        return text;
      }

      /**
       * Generates a content following the basic drill definition.
       */
      static generateBasicDrill(keys, weights, length=50) {
        // Implementation:
        //
        // We build an array contains all keys. Each key is duplicated to reflect
        // its weight:
        // 
        //   generateStaticDrill(['a', 'b'], [2. 1]);
        //   # letters = ['a', 'a', 'b']
        //
        // Then, we generate n random numbers (between 0 and the length of `letters`).
        // For each generated number, we append the letter at this index.
        
        if (!weights) {
          weights = Array(this.content.length).fill(1);
        }
        
        let letters = []
        for (let i = 0; i < keys.length; i++) {
          for (let j = 0; j < weights[i]; j++) {
              letters.push(keys[i]);
          }
        }
        
        let getRandomInt = (max) => Math.floor(Math.random() * Math.floor(max));
        let content = "";
        for (let i = 0; i < length; i++) {
          content += letters[getRandomInt(letters.length)];
        }
        return content;
      }
      
      /**
       * Generates a content following the program drill definition.
       */
      static generateProgramDrill(program) {
        // TODO implement
        return program;
      }
      
      /**
       * Generates a content following the regex drill definition.
       */
      static generateRegexDrill(regexes) {
        // TODO implement
        return "hello world";
      }

    }
    window.customElements.define(TypioDrillCreator.is, TypioDrillCreator);

  </script>
</dom-module>
