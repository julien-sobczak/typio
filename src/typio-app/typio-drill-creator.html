<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html">

<link rel="import" href="/src/typio-app/typio-drill-static-input.html">
<link rel="import" href="/src/typio-app/typio-drill-basic-input.html">
<link rel="import" href="/src/typio-app/typio-drill-program-input.html">
<link rel="import" href="/src/typio-app/typio-drill-regex-input.html">

<link rel="import" href="/src/typio-app/shared-styles.html">

<dom-module id="typio-drill-creator">
  <template>
    <style include="shared-styles">

      :host {
        background-color: #666;
      }
      
      section {
        padding: 50px;
        width: 100%;
        height: 100%
        overflow-y: scroll;
      }
      
      #form {
        max-width: 1000px;
        margin: 25px auto;
      }
      
      paper-input {
        --primary-text-color: var(--typio-bg-color);
        --secondary-text-color: white;
        --paper-input-container-color: white;
        --paper-input-container-focus-color: var(--typio-bg-color);
        --paper-font-subhead_-_font-size: 140%;
        
        width: 600px;
        margin: 0 auto;
      }
      
      paper-radio-group {
        margin: 50px auto;
      }
      
      paper-radio-button {
        --paper-radio-button-unchecked-color:	rgba(0,0,0,0.5);
        --paper-radio-button-unchecked-ink-color: rgba(0,0,0,0.5);
        --paper-radio-button-checked-color: white;
        --paper-radio-button-checked-ink-color: black;
        --paper-radio-button-size: 20px;
        --paper-radio-button-ink-size: 48px;
        --paper-radio-button-label-color: white;
        --paper-radio-button-radio-container {
          display: block;
          align-self: center;
          text-align: left;
          max-width: 200px;
          border: 1px solid white;
          padding: 10px 25px;
          margin: 20px auto;
        }
      }
      paper-radio-button[checked] {
        background-color: rgba(0,0,0,0.5);
        font-weight: bold;
      }
      paper-radio-button .subtitle {
        display: block;
        font-size: 0.8em;
        margin-top: 2px;
      }
      
      /* Hide all types by default. We will revealed when user select one type. */
      typio-drill-static-input,
      typio-drill-basic-input,
      typio-drill-program-input,
      typio-drill-regex-input {
        display: none;
      }
      #creator.type-static  typio-drill-static-input  { display: block; }
      #creator.type-basic   typio-drill-basic-input   { display: block; }
      #creator.type-program typio-drill-program-input { display: block; }
      #creator.type-regex   typio-drill-regex-input   { display: block; }
      
    </style>
    
    <section id="creator" class$="type-{{type}}">
      
      <paper-fab icon="create" title="Create" on-click="create"></paper-fab>
      <paper-fab icon="av:play-arrow" title="Try" on-click="try"></paper-fab>

      <div id="form">
        <!-- Common properties --> 
        <paper-input id="name" label="Name"></paper-input>
        <paper-input id="description" label="Description"></paper-input>
        
        <paper-radio-group selected="{{type}}">
          <paper-radio-button name="static">
            Static
            <span class="subtitle">For obvious content</span>
          </paper-radio-button>
          <paper-radio-button name="basic">
            Basic
            <span class="subtitle">For a little randomization</span>
          </paper-radio-button>
          <paper-radio-button name="program">
            Program
            <span class="subtitle">For the aspiring hackers</span>
          </paper-radio-button>
          <paper-radio-button name="regex">
            Regex
            <span class="subtitle">For the craziest ones</span>
          </paper-radio-button>
        </paper-radio-group>
      
        <!-- Specific configuration -->
        <typio-drill-static-input name="static"></typio-drill-static-input>
        <typio-drill-basic-input name="basic"></typio-drill-basic-input>
        <typio-drill-program-input name="program"></typio-drill-program-input>
        <typio-drill-regex-input name="regex"></typio-drill-regex-input>
        
      </div>
      
    </section>

  </template>

  <script>
  

    /**
     * @customElement
     * @polymer
     */
    class TypioDrillCreator extends Polymer.Element {

      static get is() { return 'typio-drill-creator'; }
      static get properties() {
        return {
            
          /** 
           * Which type of drill to use.
           */
          type: {
            type: String,
            value: 'static'
          },
          
        };
      }
      
      //
      // Utils
      //
      
      
      static generateDrill(drill) {
        switch (drill.type) {
          case 'static':
            return TypioDrillCreator.generateStaticDrill(drill.text);
          case 'basic':
            return TypioDrillCreator.generateBasicDrill(drill.keys, drill.weights);
          case 'program':
            return TypioDrillCreator.generateProgramDrill(drill.javascriptCode);
          case 'regex':
            return TypioDrillCreator.generateRegexDrill(drill.regexes);
        }
      }

      /**
       * Generates a content following the static drill definition.
       */
      static generateStaticDrill(text) {
        return text;
      }

      /**
       * Generates a content following the basic drill definition.
       */
      static generateBasicDrill(keys, weights, length=50) {
        // Implementation:
        //
        // We build an array contains all keys. Each key is duplicated to reflect
        // its weight:
        // 
        //   generateStaticDrill(['a', 'b'], [2. 1]);
        //   # letters = ['a', 'a', 'b']
        //
        // Then, we generate n random numbers (between 0 and the length of `letters`).
        // For each generated number, we append the letter at this index.
        
        if (!weights) {
          weights = Array(keys.length).fill(1);
        }
        
        let letters = []
        for (let i = 0; i < keys.length; i++) {
          for (let j = 0; j < weights[i]; j++) {
              letters.push(keys[i]);
          }
        }
        
        let getRandomInt = (max) => Math.floor(Math.random() * Math.floor(max));
        let content = "";
        for (let i = 0; i < length; i++) {
          content += letters[getRandomInt(letters.length)];
        }
        return content;
      }
      
      /**
       * Generates a content following the program drill definition.
       */
      static generateProgramDrill(code) {
        // TODO implement
        return code;
      }
      
      /**
       * Generates a content following the regex drill definition.
       */
      static generateRegexDrill(regexes) {
        // TODO implement
        return "hello world";
      }

    }
    window.customElements.define(TypioDrillCreator.is, TypioDrillCreator);

  </script>
</dom-module>
